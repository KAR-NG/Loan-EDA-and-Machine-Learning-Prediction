---
title: "loan"
author: "Kar Ng"
date: "1/24/2022"
output: 
  github_document: 
    toc: true
    toc_depth: 4
always_allow_html: yes
---

***


***


## 1 SUMMARY




## 2 R PACKAGES

```{r}
library(tidyverse)
library(skimr)
library(caret)
library(kableExtra)

```

## 3 INTRODUCTION

It is a machine learning project to demonstrate my technical experiences. This project uses datasets that are related to loan borrowing. 

I will use statistical modeling in machine learning to study the datasets and to extract important variables that are related to loan approval by the loan provider. I will also create predictive models that are able to make accurate prediction when new data are coming.

Information to be analysed include gender, marital status, number of dependents, education level, self employment, applicant income, co-applicant income, loan amount, loan amount term, credit history, and area of respondents' property. 

Two datasets are given, one is named 'train.data' and the another named 'test.data'. Both datasets have same information but the train.data has one more variable 'loan status', which contains the loan results.

There will be 3 datasets involved in this project. During modeling, I will split the train.data into two sbuject, one is a smaller subset with a name **"train_set"** and another named **"test_set"**. The **train_set** will be used to make various models and the **test_set** will be used to evaluate these models.

Ultimately, the best model will be used to predict the 'test.data'. 



## 4 DATA PREPARATION

Data is downloaded from the [Kaggle](https://www.kaggle.com/altruistdelhite04/loan-prediction-problem-dataset). Two datasets are downloaded, a train and a test data.

### 4.1 Data import

The train and the test data are imported in following code chunk.

```{r}
train.data <- read.csv("train_loan.csv", na.strings = c("", "NA"))
test.data <- read.csv("test_loan.csv", na.strings = c("", "NA"))

```

### 4.2 Data exploration

There are 13 variables for the train.data and 12 variables for the test.data. Both dataset have similar variable, however there is an additional variable in train.data, the "Loan_Status" which records the loan outcome. Test.data is the dataset that requiring me to make prediction using the train.data. 

Following show the first 6 rows of the train.data and the test.data.

```{r}
head(train.data)

```

```{r}
head(test.data)
     
```
From structural analysis, 

* There are 614 observations (rows) in the train.data dataset and 367 observations in the test.data dataset.      
* Train.data has the last variable 'Loan_status' that has either 'Y' or 'N' to indicate the success of a loan.  
* The 'Loan_Amount_Term', which is the length of time a loan is to be completely paid off, has repeated levels. For example, the replication of 360. It may indicate that this variable has categorical nature and should be converted in factor type. 

```{r}
str(train.data)

```

```{r}
str(test.data)

```

To detect missing values (NA), 

* In the train.data,  
  * There are 8 character and 5 numerical variables.
  * The dataset is quite complete (checking on the **n_missing** and **complete_rate**).   
  * There are many variables with a few missing values, and they have complete_rate higher 90%.  
  * The variable **Credit_History** is either 1 or 0, which is a binary variable and should be converted into factor during data cleaning. 
  
```{r}
skim_without_charts(train.data)

```
* The same situation goes to the test.data dataset. 

```{r}
skim_without_charts(test.data)

```
## 5 DATA CLEANING

### 5.1 Train.data 

#### 5.1.1 Remove ID and factor conversion

First, I will remove the "Loan_ID" and convert all character variables into factor because they are categorical variable. I remove LOan_ID because it is meaningless for predictive analysis. 

Converting variables into factors will help my analysis because it gives the data a grouping features which will enable useful R function as well as visualisation in later stage. 

```{r}

train.data <- train.data %>% 
  select(-Loan_ID) %>%                                    # Remove Loan_ID 
  mutate_if(is_character, as.factor) %>%                  # Convert all character into factor.
  mutate(Credit_History = as.factor(Credit_History),      # Convert Credit_History into factor.
         Loan_Amount_Term = as.factor(Loan_Amount_Term))  # Convert Loan_Amount_Term into factor.

```

After converting categorical variables into factor, following function help to summarise the dataset.  

```{r}

summary(train.data)

```
Many variables have missing values, as denoted by "NA's". Missing values will be filled up in next section.


#### 5.1.2 Replacing NA

Following codes replace all the NA with respective mode, which is the most occurring category of variable they belong. It is a decision after carefully examining its feasibility, these missing values are less than 5%, and their respective most occurring category have frequencies that are way higher than the rest of the categories. 

```{r}
train.data <- train.data %>% 
  mutate(Gender = replace_na(Gender, "Male"),
         Married = replace_na(Married, "Yes"),
         Dependents = replace_na(Dependents, '0'),
         Self_Employed = replace_na(Self_Employed, 'No'),
         Loan_Amount_Term = replace_na(Loan_Amount_Term, '360'))
  
summary(train.data)

```
Regarding the NA in credit history, I found that the 50 NA is too many (8%), and is quite close to 89 of "0". I decided to make it a new level. 

```{r}
50/(89+475+50) 

```
```{r}
names(train.data)
```


```{r}
train.data2 <- train.data %>% 
  mutate(Credit_History = replace_na(Credit_History, "3"))

```

```{r}
summary(train.data2)

```





### 6 REFERENCE


https://www.kaggle.com/altruistdelhite04/loan-prediction-problem-dataset
